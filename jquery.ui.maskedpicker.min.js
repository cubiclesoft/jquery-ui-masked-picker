// Rangy Inputs, a jQuery plug-in for selection and caret manipulation within textareas and text inputs.
// https://github.com/timdown/rangyinputs
// Copyright 2014, Tim Down
// Licensed under the MIT license.
// Version: 1.2.0
// Build date: 30 November 2014
!function(e){function t(e,t){var n=typeof e[t];return"function"===n||!("object"!=n||!e[t])||"unknown"==n}function n(e,t){return typeof e[t]!=x}function r(e,t){return!("object"!=typeof e[t]||!e[t])}function o(e){window.console&&window.console.log&&window.console.log("RangyInputs not supported in your browser. Reason: "+e)}function a(e,t,n){return 0>t&&(t+=e.value.length),typeof n==x&&(n=t),0>n&&(n+=e.value.length),{start:t,end:n}}function c(e,t,n){return{start:t,end:n,length:n-t,text:e.value.slice(t,n)}}function l(){return r(document,"body")?document.body:document.getElementsByTagName("body")[0]}var i,u,s,d,f,v,p,m,g,x="undefined";e(document).ready(function(){function h(e,t){var n=e.value,r=i(e),o=r.start;return{value:n.slice(0,o)+t+n.slice(r.end),index:o,replaced:r.text}}function y(e,t){e.focus();var n=i(e);return u(e,n.start,n.end),""==t?document.execCommand("delete",!1,null):document.execCommand("insertText",!1,t),{replaced:n.text,index:n.start}}function T(e,t){e.focus();var n=h(e,t);return e.value=n.value,n}function E(e,t){return function(){var n=this.jquery?this[0]:this,r=n.nodeName.toLowerCase();if(1==n.nodeType&&("textarea"==r||"input"==r&&/^(?:text|email|number|search|tel|url|password)$/i.test(n.type))){var o=[n].concat(Array.prototype.slice.call(arguments)),a=e.apply(this,o);if(!t)return a}return t?this:void 0}}var S=document.createElement("textarea");if(l().appendChild(S),n(S,"selectionStart")&&n(S,"selectionEnd"))i=function(e){var t=e.selectionStart,n=e.selectionEnd;return c(e,t,n)},u=function(e,t,n){var r=a(e,t,n);e.selectionStart=r.start,e.selectionEnd=r.end},g=function(e,t){t?e.selectionEnd=e.selectionStart:e.selectionStart=e.selectionEnd};else{if(!(t(S,"createTextRange")&&r(document,"selection")&&t(document.selection,"createRange")))return l().removeChild(S),void o("No means of finding text input caret position");i=function(e){var t,n,r,o,a=0,l=0,i=document.selection.createRange();return i&&i.parentElement()==e&&(r=e.value.length,t=e.value.replace(/\r\n/g,"\n"),n=e.createTextRange(),n.moveToBookmark(i.getBookmark()),o=e.createTextRange(),o.collapse(!1),n.compareEndPoints("StartToEnd",o)>-1?a=l=r:(a=-n.moveStart("character",-r),a+=t.slice(0,a).split("\n").length-1,n.compareEndPoints("EndToEnd",o)>-1?l=r:(l=-n.moveEnd("character",-r),l+=t.slice(0,l).split("\n").length-1))),c(e,a,l)};var w=function(e,t){return t-(e.value.slice(0,t).split("\r\n").length-1)};u=function(e,t,n){var r=a(e,t,n),o=e.createTextRange(),c=w(e,r.start);o.collapse(!0),r.start==r.end?o.move("character",c):(o.moveEnd("character",w(e,r.end)),o.moveStart("character",c)),o.select()},g=function(e,t){var n=document.selection.createRange();n.collapse(t),n.select()}}l().removeChild(S);var b=function(e,t){var n=h(e,t);try{var r=y(e,t);if(e.value==n.value)return b=y,r}catch(o){}return b=T,e.value=n.value,n};d=function(e,t,n,r){t!=n&&(u(e,t,n),b(e,"")),r&&u(e,t)},s=function(e){u(e,b(e,"").index)},m=function(e){var t=b(e,"");return u(e,t.index),t.replaced};var R=function(e,t,n,r){var o=t+n.length;if(r="string"==typeof r?r.toLowerCase():"",("collapsetoend"==r||"select"==r)&&/[\r\n]/.test(n)){var a=n.replace(/\r\n/g,"\n").replace(/\r/g,"\n");o=t+a.length;var c=t+a.indexOf("\n");"\r\n"==e.value.slice(c,c+2)&&(o+=a.match(/\n/g).length)}switch(r){case"collapsetostart":u(e,t,t);break;case"collapsetoend":u(e,o,o);break;case"select":u(e,t,o)}};f=function(e,t,n,r){u(e,n),b(e,t),"boolean"==typeof r&&(r=r?"collapseToEnd":""),R(e,n,t,r)},v=function(e,t,n){var r=b(e,t);R(e,r.index,t,n||"collapseToEnd")},p=function(e,t,n,r){typeof n==x&&(n=t);var o=i(e),a=b(e,t+o.text+n);R(e,a.index+t.length,o.text,r||"select")},e.fn.extend({getSelection:E(i,!1),setSelection:E(u,!0),collapseSelection:E(g,!0),deleteSelectedText:E(s,!0),deleteText:E(d,!0),extractSelectedText:E(m,!1),insertText:E(f,!0),replaceSelectedText:E(v,!0),surroundSelectedText:E(p,!0)})})}(jQuery);


// jQuery UI Masked Picker.
// (C) 2014 CubicleSoft.  All Rights Reserved.
!function(e){e.widget("cubiclesoft.maskedpicker",{options:{widthElement:null,minWidth:-1,maxWidth:-1,mask:[],initial:null,onInit:null,onUpdate:null,onCleanupPage:null,onShowPage:null,onKeypress:null,myPosition:"left top",atPosition:"left bottom",showOptions:{},hideOptions:{},finalElement:null},_create:function(){if(this.nodeName=this.element[0].nodeName.toLowerCase(),this.currPage=-1,this.focusTimeout=null,this.focusEnabled=!0,this.focusElement=null,this.focusSetSelection=!1,0===e("#maskedpicker-page-div").length){var t='<div id="maskedpicker-page-div" class="maskedpicker-page ui-widget ui-helper-clearfix ui-corner-all" style="position: absolute; display: none;">';t+='	<div class="maskedpicker-widget ui-widget ui-widget-content ui-helper-clearfix ui-corner-all">',t+='		<div class="maskedpicker-header ui-widget-header ui-helper-clearfix ui-corner-all">',t+='			<a class="maskedpicker-prev ui-corner-all" data-event="click" data-type="prev" title="Prev"><span class="ui-icon ui-icon-circle-triangle-w">Prev</span></a>',t+='			<a class="maskedpicker-next ui-corner-all" data-event="click" data-type="next" title="Next"><span class="ui-icon ui-icon-circle-triangle-e">Next</span></a>',t+='			<div class="maskedpicker-title"></div>',t+="		</div>",t+='		<div class="maskedpicker-body ui-helper-clearfix"></div>',t+="	</div>",t+="</div>",e("body").append(t);var i=e("#maskedpicker-page-div");i.data("started",!1),i.data("clickfocus",!1),i.find(".maskedpicker-prev").hover(function(){e(this).toggleClass("ui-state-hover"),e(this).toggleClass("maskedpicker-prev-hover")}).click(function(){var e=i.data("current");e&&e.selectPage(e.prevPage())}),i.find(".maskedpicker-next").hover(function(){e(this).toggleClass("ui-state-hover"),e(this).toggleClass("maskedpicker-next-hover")}).click(function(){var e=i.data("current");e&&e.selectPage(e.nextPage())}),i.click(function(){var t=e(this).data("current");t&&t._resetFocus()}),i.on("mousedown",function(){var t=e(this).data("current");t&&(e(this).data("started",!0),t._resetFocusTimeout())}),i.on("dragstart",function(){var t=e(this).data("current");return t?(e(this).data("started",!0),t._resetFocusTimeout(),!1):void 0}),e(document).on("mousedown",function(){i.data("clickfocus",!0)}),e(document).on("mouseup",function(){i.data("clickfocus",!1);var e=i.data("current");e&&i.data("started")&&(i.data("started",!1),e._resetFocus())}),e(document).on("keydown",function(e){e.isDefaultPrevented()||i.data("lastKeypress",e)}),e(window).on("resize",function(){var e=i.data("current");e&&e._internalUpdateWidgetPosition()}),e(window).on("focus",function(){var e=i.data("current");e&&i.data("started")&&(i.data("started",!1),e._resetFocus())}),e(window).on("blur",function(){var e=i.data("current");e&&i.data("started",!0)}),e("body").on("focus",function(){var e=i.data("current");e&&i.data("started")&&(i.data("started",!1),e._resetFocus())}),e("body").on("blur",function(){var e=i.data("current");e&&i.data("started",!0)})}if(this.pageDiv=e("#maskedpicker-page-div"),this.element.addClass("maskedpicker-input"),"undefined"!=typeof this.options.finalElement&&null!==this.options.finalElement&&""!=this.options.finalElement.val()){var s=JSON.parse(this.options.finalElement.val());for(x=0;x<s.length&&x<this.options.mask.length;x++)s[x].type===this.options.mask[x].type&&(this.options.mask[x].selected=s[x].selected,this.options.mask[x].selectedHtml=this._unicodeToHtml(this.options.mask[x].selected))}else"input"!==this.nodeName&&"textarea"!==this.nodeName||"string"==typeof this.options.initial?"string"==typeof this.options.initial&&this.setValue(this.options.initial):this.setValue(this.element.val());var a=this;this.refresh(),this._on(this.element,{focus:function(){a._resetFocusTimeout(),!a.pageDiv.data("clickfocus")&&a.focusEnabled&&(a.focusTimeout=setTimeout(function(){a._handleFocus()},100))},selectionchange:function(){a._resetFocusTimeout(),a.focusTimeout=setTimeout(function(){a._handleFocus()},500)},click:function(){a._resetFocusTimeout(),a.pageDiv.data("lastKeypress",null),a.focusTimeout=setTimeout(function(){a._handleFocus()},100)},change:function(){a.refresh()},dragstart:function(){return!1},drop:function(){a._resetFocusTimeout(),a.pageDiv.data("lastKeypress",null),a.focusTimeout=setTimeout(function(){a._handleFocus()},100)},blur:function(){a._resetFocusTimeout(),a.focusEnabled&&(a.focusTimeout=setTimeout(function(){a._handleBlur()},100))},keydown:function(e){a._handleKeypress(e)},keypress:function(e){a._handleKeypress(e)}})},_destroy:function(){this._resetFocusTimeout(),this.hidePage(),this.element.removeClass("maskedpicker-input")},_setOption:function(e,t){this._super(e,t)},_setOptions:function(e){this._super(e),this.refresh()},setValue:function(t){for(var i=0;i<this.options.mask.length;i++){var s=this.options.mask[i];if("date"===s.type){s.initial="";var a=e.datepicker.parseDate("string"==typeof s.options.dateFormat?s.options.dateFormat:"mm/dd/yy",t,s.options);if(a&&(a=e.datepicker.formatDate("string"==typeof s.options.dateFormat?s.options.dateFormat:"mm/dd/yy",a,s.options))){s.initial=a;var n=t.indexOf(a);n>-1&&(t=t.substring(n+a.length))}s.selected=s.initial}else if("fixed"===s.type){var n=t.indexOf(s.value);n>-1&&(t=t.substring(n+s.value.length))}else if("select"==s.type){s.initial="";for(var o=t.length,l=!1,r=0;r<s.values.length;r++)for(var c=0;c<s.values[r].length;c++)if(s.values[r][c]!==!1){var n=t.indexOf(s.values[r][c]);n>-1&&o>=n&&(o=n,l=s.values[r][c])}o<t.length&&l!==!1&&(s.initial=l,t=t.substring(o+l.length)),s.selected=s.initial}else if("freeform"==s.type){if(s.initial="","undefined"!=typeof s.pattern){var h=t.match(s.pattern);if(h){var u=h[0];"undefined"!=typeof s.limit&&s.limit<=u.length&&(u=u.substring(0,s.limit));var n=t.indexOf(u);n>-1&&(s.initial=u,t=t.substring(n+u.length))}}else"undefined"!=typeof s.limit&&s.limit<=t.length?(s.initial=t.substring(0,s.limit),t=t.substring(s.limit)):(s.initial=t,t="");if("undefined"!=typeof s.limit&&"string"==typeof s.pad&&"string"==typeof s.padchar&&1==s.padchar.length)for(;s.initial.length<s.limit;)if("prefix"===s.pad)s.initial=s.padchar+s.initial;else{if("suffix"!==s.pad)break;s.initial+=s.padchar}s.selected=s.initial}else"function"==typeof this.options.onInit&&(t=this.options.onInit.call(this,t,s,i,this.options.mask))}},refresh:function(){this._setval(this._internalUpdate()),this._internalUpdateSelection(),this._internalUpdateWidgetPosition()},nearestPage:function(e){if(e>=this.options.mask.length&&(e=this.options.mask.length-1),0>e&&(e=-1),e>-1&&e!=this.currPage&&(this._internalUpdate(),"string"!=typeof this.options.mask[e].page)){for(var t=e-1,i=e+1;t>-1||i<this.options.mask.length;){if(i<this.options.mask.length&&"string"==typeof this.options.mask[i].page){e=i;break}if(t>-1&&"string"==typeof this.options.mask[t].page){e=t;break}i++,t--}"string"!=typeof this.options.mask[e].page&&(e=-1)}return e},selectPage:function(e){if(e=this.nearestPage(e),this._resetFocus(),e!=this.currPage){var t=this.currPage;this.currPage=e,this.setFocusElement(null),this._showPage(t)}},firstPage:function(){var e;for(e=0;e<this.options.mask.length&&"string"!=typeof this.options.mask[e].page;e++);return e==this.options.mask.length?-1:e},lastPage:function(){var e;for(e=this.options.mask.length;e>0&&"string"!=typeof this.options.mask[e-1].page;e--);return e--,e},prevPage:function(){if(this.currPage<1)return-1;var e;for(e=this.currPage;e>0&&"string"!=typeof this.options.mask[e-1].page;e--);return e--,e},nextPage:function(){if(this.currPage<0)return-1;var e;for(e=this.currPage+1;e<this.options.mask.length&&"string"!=typeof this.options.mask[e].page;e++);return e==this.options.mask.length?-1:e},hidePage:function(){if(this.currPage>-1){var e=this.currPage;this.currPage=-1,this._showPage(e)}},setFocusElement:function(e){if(this._resetFocusTimeout(),this.focusElement=e,null===e)this.focusEnabled=!0;else{var t=this;this.focusEnabled=!1,this.focusTimeout=setTimeout(function(){t._resetFocus()},100)}},_setval:function(e){"input"===this.nodeName||"textarea"===this.nodeName?this.element.val(e):this.element.text(e)},_resetFocusTimeout:function(){this.focusTimeout&&(clearTimeout(this.focusTimeout),this.focusTimeout=null)},_internalUpdate:function(){("undefined"==typeof this.options.widthElement||null===this.options.widthElement)&&(this.options.widthElement=this.element);for(var e="",t=0;t<this.options.mask.length;t++){var i=this.options.mask[t];if("string"!=typeof i.prefix&&(i.prefix=""),"string"!=typeof i.suffix&&(i.suffix=""),"string"!=typeof i.initial&&(i.initial="string"==typeof i.selected?i.selected:"string"==typeof i.value?i.value:""),"string"!=typeof i.selected&&(i.selected=i.initial),"string"!=typeof i.selectedHtml&&(i.selectedHtml=i.selected),"string"!=typeof i.entered&&(i.entered=""),t==this.currPage&&"freeform"===i.type&&null!==this.focusElement){var s=this.focusElement.val();if("undefined"!=typeof i.pattern){var a=s.match(i.pattern);if(a){var n=a[0];"undefined"!=typeof i.limit&&i.limit<=n.length&&(n=n.substring(0,i.limit));var o=s.indexOf(n);o>-1&&(i.selected=n)}}else i.selected="undefined"!=typeof i.limit&&i.limit<=s.length?s.substring(0,i.limit):s;if("undefined"!=typeof i.limit&&"string"==typeof i.pad&&"string"==typeof i.padchar&&1==i.padchar.length)for(;i.selected.length<i.limit;)if("prefix"===i.pad)i.selected=i.padchar+i.selected;else{if("suffix"!==i.pad)break;i.selected+=i.padchar}i.selectedHtml=this._unicodeToHtml(i.selected)}i.value=i.prefix+i.selected+i.suffix,"function"==typeof this.options.onUpdate&&this.options.onUpdate.call(this,i,t,this.options.mask),i.start=e.length,e+=i.value}if("undefined"!=typeof this.options.finalElement&&null!==this.options.finalElement){for(var l=[],t=0;t<this.options.mask.length;t++){var i=this.options.mask[t];l[t]={type:i.type,selected:i.selected}}this.options.finalElement.val(JSON.stringify(l))}return e},_internalUpdateSelection:function(){if(null===this.focusElement&&this.currPage>-1){var e=this.options.mask[this.currPage];this.element.setSelection(e.start,e.start+e.value.length)}},_handleFocus:function(){this.focusTimeout=null,this.pageDiv.data("current",this);var e=this.element.getSelection();null!==this.focusElement&&this.focusElement.focus(),this.refresh();var t=this.pageDiv.data("lastKeypress");if(null===this.focusElement&&t&&("string"==typeof t&&"shift+tab"===t||"object"==typeof t&&t.shiftKey&&9==t.keyCode))this.selectPage(this.lastPage());else if(null===this.focusElement&&t&&("string"==typeof t&&"tab"===t||"object"==typeof t&&!t.shiftKey&&9==t.keyCode))this.selectPage(this.firstPage());else if(e){var i,s=0;for(i=0;i<this.options.mask.length&&s+this.options.mask[i].value.length<e.start;i++)s+=this.options.mask[i].value.length;this.selectPage(i)}},_resetFocus:function(){this._resetFocusTimeout(),this.pageDiv.data("started")||(this.focusEnabled=!1,null!==this.focusElement?(this.focusElement.is(":focus")||this.focusElement.focus(),this.focusSetSelection&&(this.focusSetSelection=!1,this.focusElement.setSelection(0,this.focusElement.val().length))):("input"===this.nodeName||"textarea"===this.nodeName)&&(this.element.is(":focus")||this.element.focus()),this.refresh(),null===this.focusElement&&(this.focusEnabled=!0))},_handleBlur:function(){this.focusTimeout=null,this.pageDiv.data("started")||(this._setval(this._internalUpdate()),this.hidePage())},_cleanupPage:function(e){if(e>-1){var t=this.options.mask[e],i=this.pageDiv.find("div.maskedpicker-body");switch(t.type){case"date":i.datepicker("destroy");break;case"select":i.find(".maskedpicker-body-select").off("click","td a");break;case"freeform":null!==this.focusElement&&this.refresh(),this.setFocusElement(null)}"function"==typeof this.options.onCleanupPage&&this.options.onCleanupPage.call(this,t,i,e,this.options.mask)}},_escapeHtml:function(e){var t={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[<>"']/g,function(e){return t[e]})},_unicodeToHtml:function(e){return e.replace(/[\u00A0-\u2666]/g,function(e){return"&#"+e.charCodeAt(0)+";"})},_generateSelectHtml:function(e,t){var i="";t&&(i+='<div class="maskedpicker-body-select">'),i+="<table><tbody>";for(var s=0;s<e.values.length;s++){i+="<tr>";for(var a=0;a<e.values[s].length;a++){var n="";e.fixed&&a<e.values[s].length-1&&(n+=(""!=n?" ":"")+"width: "+100/e.values[s].length+"%;");var o="";e.values[s][a]===!1&&(o+=(""!=o?" ":"")+"ui-state-disabled"),i+="<td"+(""!=o?' class="'+o+'"':"")+(""!=n?' style="'+n+'"':"")+">","string"==typeof e.values[s][a]&&(i+='<a href="#" class="ui-state-default'+(e.values[s][a]===e.selectedHtml?" ui-state-active":"")+'" data-value="'+this._escapeHtml(e.values[s][a])+'">'+this._escapeHtml(e.values[s][a])+"</a>"),i+="</td>"}i+="</tr>"}return i+="</tbody></table>",t&&(i+="</div>"),i},_showPage:function(t){var i=this;if(this.currPage<0)this.currPage=-1,this.pageDiv.data("current",null),this.options.hideOptions.complete=function(){i._cleanupPage(t)},t>-1?this.pageDiv.hide(this.options.hideOptions):this.pageDiv.hide(0,this.options.hideOptions.complete);else{this._cleanupPage(t),this._resetFocus(),this._internalUpdateSelection(),this.pageDiv.hide().finish();var s=this.options.mask[this.currPage];this.pageDiv.find(".maskedpicker-title").html(s.page);var a=this.pageDiv.find("div.maskedpicker-body");switch(a.html(""),s.entered="",html="",s.type){case"date":s.options.defaultDate=s.selected,s.options.onSelect=function(e){s.selected=e,s.selectedHtml=i._unicodeToHtml(s.selected),i.nextPage()>-1?i.selectPage(i.nextPage()):i.refresh()},a.datepicker(s.options);break;case"select":"undefined"==typeof s.fixed&&(s.fixed=!0),a.html(this._generateSelectHtml(s,!0)),a.find(".maskedpicker-body-select").on("click","td a",function(t){if(s.selected=e(t.target).attr("data-value"),s.selectedHtml=i._unicodeToHtml(s.selected),i.pageDiv.data("lastKeypress","tab"),i.nextPage()>-1)i.selectPage(i.nextPage());else{var a=i.focusElement;i.hidePage();var n=i._findNextInput(i.element,a);n&&n.focus()}t.preventDefault()});break;case"freeform":html+="input"!==this.nodeName&&"undefined"!=typeof s.multiline&&s.multiline?'<div><textarea class="maskedpicker-body-freeform ui-widget ui-widget-content ui-corner-all">'+s.selectedHtml+"</textarea></div>":'<div><input type="text" class="maskedpicker-body-freeform ui-widget ui-widget-content ui-corner-all" value="'+s.selectedHtml+'" /></div>',a.html(html),s.lastSelected=s.selected;var n=a.find(".maskedpicker-body-freeform");this.setFocusElement(n),this.focusSetSelection=!0,n.on("blur",function(){i._resetFocusTimeout(),i.focusTimeout=setTimeout(function(){i._handleBlur()},100)}),n.on("keydown",function(e){i._handleKeypress(e)}),n.on("keypress",function(e){i._handleKeypress(e)})}"function"==typeof this.options.onShowPage&&this.options.onShowPage.call(this,s,a,this.currPage,this.options.mask),this._internalUpdateWidgetPosition(),t>-1?this.pageDiv.show():this.pageDiv.show(this.options.showOptions)}},_internalUpdateWidgetPosition:function(){if(this.currPage>-1){var e=this.options.widthElement.width();e<this.options.minWidth&&(e=this.options.minWidth),this.options.maxWidth>-1&&e>this.options.maxWidth&&(e=this.options.maxWidth),this.pageDiv.width(e);var t=this.pageDiv.is(":visible");t||this.pageDiv.css({top:"-1000px"}).show(),this.prevPage()>-1?this.pageDiv.find(".maskedpicker-prev").show():this.pageDiv.find(".maskedpicker-prev").hide(),this.nextPage()>-1?this.pageDiv.find(".maskedpicker-next").show():this.pageDiv.find(".maskedpicker-next").hide(),this.pageDiv.position({of:this.element,my:this.options.myPosition,at:this.options.atPosition,collision:"flip"}),t||this.pageDiv.hide()}},_findPrevInput:function(t,i){var s=e(e("a[href], button, input, select, textarea").not(i).filter(":visible").filter("a, :enabled").toArray().sort(function(e,t){return(e.tabIndex>0?e.tabIndex:1e3)-(t.tabIndex>0?t.tabIndex:1e3)})),a=s.index(t)-1;return 0>a&&(a=s.length-1),s.eq(a)},_findNextInput:function(t,i){var s=e(e("a[href], button, input, select, textarea").not(i).filter(":visible").filter("a, :enabled").toArray().sort(function(e,t){return(e.tabIndex>0?e.tabIndex:1e3)-(t.tabIndex>0?t.tabIndex:1e3)})),a=s.index(t)+1;return a>=s.length&&(a=0),s.eq(a)},_updateEnteredTracker:function(e,t){var i=t.find(".maskedpicker-body-enteredinput");if(""===e.entered)i.remove();else{if(0===i.length){var s="";s+='<div class="maskedpicker-body-enteredinput ui-widget-content"></div>',t.append(s),i=t.find(".maskedpicker-body-enteredinput")}i.text(e.entered)}},_specialKeys:{8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},_shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"},_getKeypressOptions:function(t){var i=this._specialKeys[t.keyCode],s="";e.each(["alt","ctrl","meta","shift"],function(e,a){t[a+"Key"]&&i!==a&&(s+=a+"+")}),s=s.replace("alt+ctrl+meta+shift","hyper");var a={},n=0!==t.which?String.fromCharCode(t.which).toLowerCase():null;return a.special=i,i&&(a[s+i]=!0),a.character=n,n&&("keypress"===t.type&&(a.special=null),a[s+n]=!0,this._shiftNums[n]&&(a[s+this._shiftNums[n]]=!0,"shift+"===s&&(a[this._shiftNums[n]]=!0))),a},_handleKeypress:function(t){if(!(this.currPage<0)){var i=this._getKeypressOptions(t);this.refresh(),this._resetFocusTimeout();var s=this;this.focusTimeout=setTimeout(function(){s._resetFocus()},20);var a=this.options.mask[this.currPage],n=this.pageDiv.find("div.maskedpicker-body"),o=!1;switch(a.type){case"date":if(i.special&&"shift"!==i.special);else if("keydown"===t.type)o=!0;else if(!i.special&&0!==t.which){var l=a.entered+String.fromCharCode(t.which);try{var r=e.datepicker.parseDate("string"==typeof a.options.dateFormat?a.options.dateFormat:"mm/dd/yy",l,a.options);r&&(a.selected=e.datepicker.formatDate("string"==typeof a.options.dateFormat?a.options.dateFormat:"mm/dd/yy",r,a.options),a.selectedHtml=a.selected,n.datepicker("setDate",a.selected))}catch(c){}a.entered=l,this._updateEnteredTracker(a,n),t.preventDefault()}break;case"select":if(i.special&&"shift"!==i.special)for(var h=0;h<a.values.length;h++)for(var u=0;u<a.values[h].length;u++)a.values[h][u]!==!1&&a.entered===a.values[h][u]&&(a.selected=a.entered,a.selectedHtml=a.selected,n.find(".maskedpicker-body-select").html(this._generateSelectHtml(a,!1)),"return"===i.special?i.right=!0:(a.entered="",this._updateEnteredTracker(a,n),t.preventDefault()));else if("keydown"===t.type)o=!0;else if(!i.special&&0!==t.which){for(var l=a.entered+String.fromCharCode(t.which),d=0,f=!1,h=0;h<a.values.length;h++)for(var u=0;u<a.values[h].length;u++)a.values[h][u]!==!1&&(a.entered===a.values[h][u]&&(f=!0),l===a.values[h][u].substring(0,l.length)&&d++);if(d){for(var h=0;h<a.values.length;h++)for(var u=0;u<a.values[h].length;u++)if(a.values[h][u]!==!1)if(1===d&&l===a.values[h][u]){if(a.selected=a.values[h][u],a.selectedHtml=a.selected,this.pageDiv.data("lastKeypress","tab"),this.nextPage()>-1)this.selectPage(this.nextPage());else{var p=this.focusElement;this.hidePage();var m=this._findNextInput(this.element,p);m&&m.focus()}t.preventDefault()}else l===a.values[h][u].substring(0,l.length)&&(a.entered=l,this._updateEnteredTracker(a,n),t.preventDefault())}else f&&this.nextPage()>-1&&(a.selected=a.entered,a.selectedHtml=a.selected,this.selectPage(this.nextPage()),t.preventDefault())}break;case"freeform":if(null!==this.focusElement)if(i.tab){if(this.nextPage()>-1)this.pageDiv.data("lastKeypress",null),this.selectPage(this.nextPage());else{this.pageDiv.data("lastKeypress",t);var p=this.focusElement;this.hidePage();var m=this._findNextInput(this.element,p);m&&m.focus()}t.preventDefault()}else if(i["shift+tab"]){if(this.prevPage()>-1)this.pageDiv.data("lastKeypress",null),this.selectPage(this.prevPage());else{this.pageDiv.data("lastKeypress",t);var p=this.focusElement;this.hidePage();var m=this._findPrevInput(this.element,p);m&&m.focus()}t.preventDefault()}else if(i.left||i["ctrl+left"]){if(this.prevPage()>-1){var g=this.focusElement.getSelection();g&&0==g.start&&0==g.end&&(this.selectPage(this.prevPage()),t.preventDefault())}}else if(i.right||i["ctrl+right"]){if(this.nextPage()>-1){var g=this.focusElement.getSelection(),h=this.focusElement.val().length;g&&g.start==h&&g.end==h&&(this.selectPage(this.nextPage()),t.preventDefault())}}else if("esc"===i.special){if(this.focusElement.val()!==a.initial){var v=this.focusElement.val()===a.lastSelected?a.initial:a.lastSelected;this._resetFocusTimeout(),this.focusTimeout=setTimeout(function(){s.focusElement.val(v),s._resetFocus()},20)}t.preventDefault()}else if(!i.special){var k=String.fromCharCode(t.which);if(this.nextPage()>-1){var y=this.options.mask[this.currPage+1].prefix,P=y.indexOf(k);0>P&&"fixed"===this.options.mask[this.currPage+1].type&&(y=this.options.mask[this.currPage+1].selected,P=y.indexOf(k)),P>-1&&(this.selectPage(this.nextPage()),t.preventDefault())}}o=!0}"function"==typeof this.options.onKeypress&&(o=this.options.onKeypress.call(this,o,t,i,a,n,this.currPage,this.options.mask)),o||(i.tab||i.right||i["ctrl+right"]||i.down?(this.nextPage()>-1&&(this.selectPage(this.nextPage()),i.tab&&t.preventDefault()),i.tab||t.preventDefault()):i["shift+tab"]||i.left||i["ctrl+left"]||i.up?(this.prevPage()>-1&&(this.selectPage(this.prevPage()),i["shift+tab"]&&t.preventDefault()),i["shift+tab"]||t.preventDefault()):i.home||i["ctrl+up"]?(this.selectPage(this.firstPage()),t.preventDefault()):i.end||i["ctrl+down"]?(this.selectPage(this.lastPage()),t.preventDefault()):"backspace"===i.special?(""!==a.entered?(a.entered="",this._updateEnteredTracker(a,n)):a.selected!==a.initial?(a.selected=a.initial,this._showPage(this.currPage)):this.prevPage()>-1&&this.selectPage(this.prevPage()),t.preventDefault()):"del"===i.special?(a.selected=a.initial,a.entered="",this._updateEnteredTracker(a,n),t.preventDefault()):"esc"===i.special?(""!==a.entered&&(a.entered="",this._updateEnteredTracker(a,n)),t.preventDefault()):i.special||0===t.which||t.preventDefault()),this._internalUpdateWidgetPosition()}}})}(jQuery);
